---
title: "第3章 効果量(1) 2節まで"
author: "kazutan"
date: "2015年02月23日"
output: html_document
---
## このドキュメントについて
このドキュメントは、[『続・心理統計学の基礎』（南風原朝和 著）読書会](http://www.urano-ken.com/blog/2015/01/23/dokushokai/)について作成した第3章のメモという位置づけです。主にRで簡単に実行できるコードを中心に構成しています。ただこのドキュメントのみでは意味が通らないかと思いますので、[続・心理統計学の基礎](http://www.yuhikaku.co.jp/books/detail/9784641220416)と共にご覧ください。

## 1. 研究における効果量の位置づけ

### 効果の3つの側面と効果量
<dl>
<dt>効果の有無</dt>
<dd>効果が存在するかどうか。有意性検定はこの側面に着目。</dd>
<dt>効果の大きさ</dt>
<dd>どの程度の大きさの効果があるのか。</dd>
<dt>効果の一般性</dt>
<dd>その効果がどのくらい広く一般に効果があるのか。</dd>
</dl>

…効果量は、この内2つ目の側面「効果の大きさ」を表す指標。

### 検定力を規定する効果量
#### 検定力:検定において有意な結果が得られる確率
- 他の条件(標本数、有意水準、両側・片側etc)が一定ならば、**母集団における効果量**が大きいほど高くなる
- ただ、指標によって様々だったりする
- 以降で主要な研究デザインごとに調べていく

### 解釈の観点からの効果量
- 「どの大きさの効果量が、どの程度の大きさの効果を意味するのか」
- 以降で解釈の観点から、効果量指標の選択・変換についても検討

### 標準化効果量と非標準化効果量
#### 標準化効果量
  - データの測定単位に依存しない効果量
  - 検定統計量の要素となる標本における統計量
  - 検定力を規定する母集団効果量 など

#### 非標準化効果量
  - 測定単位をそのまま反映したもの
  - 平均値差や回帰係数など

#### どちらがいいのか?
  - 非標準化効果量は測定値を解釈するのに有用な場面もしばしばある
  - 非標準化効果量と標準化効果量の両方を報告するなどの選択肢も考慮するとよし
  - 一覧はp.47参照
  - でも3章と4章では非標準化効果量に焦点が絞られてます

### 効果量の信頼区間
#### 標本データから算出される効果量は母集団効果量の推定値
- そこには**標本誤差を含む**
- 母集団効果量の**信頼区間**を算出して報告する必要

### 研究のタイプとい効果量の解釈
#### 実用主義的実験(研究)
- 現実場面での具体的な処遇の効果を調べることが目的
- 少なくとも主要な結果については、  
効果量の値の実質的な解釈を行うことが期待される
- 実際的有意性、臨床的有意性など

#### 理論確証型実験(研究)
- 何らかの理論的な仮説の検証を目的
- あくまで理論や仮説が支持されるかがポイントなので、  
通常求められる程度は低い

### 理論確証型研究における効果量の報告
#### 心理学研究の現状…
- 標本の大きさを、検定力や信頼区間などから論拠を持って決定することが、十分に普及していない
- 有意性検定の結果は、標本の大きさに大きく依存
- かなりまずいよね?

#### 効果量とその信頼区間があるなら…
- 効果の大きさや安定性が見積もれる
- 的確な結果の評価が可能
- メタ分析などでも必要となる
- やぱり必要だよね

## 2. 相関と回帰に関する効果量

### 検定力を規定する効果量
2つの変数が2変数正規分布に従うとき、母集団相関係数$\rho$の帰無仮説$H_0: \rho=0$の検定:
$$
\begin{eqnarray}
t=\frac{r}{\sqrt{1-r^2}}×\sqrt{N-2} \\
\end{eqnarray}
$$

このtが、帰無仮説のもとで自由度N-2のt分布に従うことを利用。

#### 効果量は?
上の検定統計量tの分布は母集団相関係数$\rho$と標本数Nによって決定→この2つがパラメータ  
効果量としては母集団相関係数$\rho$でOK(回帰でも同じ)

### 解釈の観点からの効果量
- 相関係数は研究者にとって解釈しやすい→$\rho$でOK  
- ただこの$\rho$は母集団の相関係数→推定量として標本相関係数$r$を使用
- しかしあくまで直線的な関係なので、散布図チェックはかわりませんよ

### 点双列相関係数
- 一方が二値変数、もう一方が連続変数における相関係数
- この場合は通常の相関と違い注意が必要

#### 点双列相関係数での効果量
- この場合、2群間(二値変数)における連続変数の平均値差をみることに
- 代表的な効果量としては、平均値差を群内の標準偏差で割った**標準化平均値差**
- 点双列相関係数$\rho$と母集団における標準化平均値差$\sigma$の関係:
$$
\begin{eqnarray}
\rho=\frac{\sigma}{\sqrt{\sigma^2+1/[\pi(1-\pi)]}} \\
\end{eqnarray}
$$

- この$\pi$は、二値変数の一方の割合を表す
- この式より、点双列相関係数$\rho$は二値変数の比率に依存して変化（テキスト参照）
- つまり二群間平均値差であっても、構成比率によって変化してしまう
- よって、片方が二値変数である場合には効果量は標準化平均値差が望ましい

### FisherのZ変換に基づくρの信頼区間
- ２変数正規分布が仮定されるなら、この方法で求めることが可能:
$$
\begin{eqnarray}
\rho_L &=& tanh(tanh^{-1}r-z_{1-\alpha/2}/\sqrt{N-3}) \\
\rho_H &=& tanh(tanh^{-1}r+z_{1-\alpha/2}/\sqrt{N-3}) \\
\end{eqnarray}
$$

では実際にやってみます。まず$y=tanh(x)$をグラフにします：
```{r}
curve(tanh(x),xlim=c(-1,1),ylim=c(-1,1))
```

次に$y=tanh^{-1}(x)$をグラフにします:
```{r}
curve(atanh(x),xlim=c(-1,1),ylim=c(-1,1))
```

ここで$z_{1-\alpha/2}$は標準正規分布の上側確率で、ここでは$.05/2=0.25$とします。テキストに合わせて標本$N=40$、$r=.5$とします:
```{r}
rhoL <- tanh(atanh(.5)-qnorm(1-.025)/sqrt(40-3))
rhoH <- tanh(atanh(.5)+qnorm(1-.025)/sqrt(40-3))
c(rhoL,rhoH)
```

これがこの母集団相関係数$\rho$の95%信頼区間です。テキストと一致します。

### 非心t分布に基づく検定力とρの信頼区間
#### 制約
- 一方を所与とし、それぞれの値におけるもう一方の変数の条件付き分布が等分散の正規分布である
- つまり「片方(x)がある値の時、もう一方(y)の分布は正規分布になる。そして違うxになったとしても、yは正規分布になる。あっでも分散は常に一緒な」
- だから片方が二値変数でもOK。回帰やANOVAもこの制約。

#### 検定統計量など
- まず、帰無仮説$H_0: \rho 0$が真である場合、これは前に述べたt分布に従います
- ですが帰無仮説$H_0: \rho 0$が偽である場合、2章の流れと同様に非心度$\lambda$の非心t分布に従います
$$
\begin{eqnarray}
\lambda = \frac{\rho}{\sqrt{1-\rho^2}}×\sqrt{N}
\end{eqnarray}
$$

- この式があれば非心度が求まり、さらに標本数と母集団相関係数を指定すれば、この時の検定力を算出可能

では実際にやってみます。テキストの脚注に合わせて標本$N=40$、$\rho=.5$とします:
```{r}
lambda.rho <- .5/sqrt(1-.5^2)*sqrt(40)
lambda.rho
```

これが非心度です。これを使って、2章で使ったグラフを流用します:
```{r}
curve(dt(x,df=40-2,ncp=0),xlim=c(-5,10),ylim=c(0,0.5),col="#ff0000")
curve(dt(x,df=40-2,ncp=lambda.rho),col="#0000ff",add=TRUE)
abline(v=qt(.975,df=40-2),col="#333333",lwd=1.5)
abline(v=qt(.025,df=40-2),col="#333333",lwd=1.5)
```

この垂直線の外側が該当します。左の垂直線より左側で、非心t分布(青色)の累積確率は…
```{r}
pt(qt(.025,df=40-2),df=40-2,ncp=lambda.rho)
```

ほぼ0です。では右の垂直線より右側での、非心t分布(青色)の累積確率は…
```{r}
1-pt(qt(.975,df=40-2),df=40-2,ncp=lambda.rho)
```

したがって、これがこの場合の検定力となり、テキストp.56脚注の値と一致します。

#### 信頼区間の算出
- **ここが前半で最重要なポイントです**
- テキスト図3-1で、曲線に挟まれた部分が信頼区間となる
- もし$r=r_0$であったとき、母集団相関係数$\rho$は縦軸のあらゆる場所の値を取りうる- しかし、これが下弧との交点aより低い値($\rho_L$)を$\rho$が行くと、「その標本での$r$は、母集団相関係数の上側2.5%を乗り越えて出てきてしまった」こととなるので**標本値と整合が取れない真値**となるので不採用
- 同様に、これが上弧との交点bより高い値($\rho_H$)を$\rho$が行くと、「その標本での$r$は、母集団相関係数の下側2.5%を下回って出てきてしまった」こととなるので**標本値と整合が取れない真値**となるので不採用
- 結果として、この$\alpha$は範囲以外には$\rho$は動きようがない。てか動いたら「有意水準」で切られてしまう
- よって、母集団相関係数$\rho$は**この有意水準では**この範囲にいるだろう、ということになる

以上より、母集団相関係数$\rho$の信頼区間は以下のステップで算出可能:

- 自由度$N-2$の非心t分布について考えよう
- この非心t分布において、「上側確率$\alpha/2$の値を決めた場合のt値」にピッタリ合うような非心度を算出→$\lambda_L$、つまり下限値。
- 算出したら、さっきの式の変形↓で信頼区間の下限$\rho_L$を算出

$$
\begin{eqnarray}
\rho = \frac{\lambda}{\sqrt{N+\lambda^2}}
\end{eqnarray}
$$

- あとは同じように$\rho_H$を算出。これが上限値。
- 下限値についてはそっちについて考えるだけ。イメージ大事です。
- **これがすべてのスタート**です。測定した標本より信頼区間を算出という流れはほぼ一緒なはず。

### 数値例
テキストと同じ事例で計算してみます。既知として$N=40,r=.5$とします。まずは検定統計量tを算出します
```{r}
toukeiryou.t <- .5/sqrt(1-.5^2)*sqrt(40-2)
toukeiryou.t
```

この値を使って信頼区間を算出します。自由度は$40-2=38$です。この自由度($df=38$)で、非心t分布がどうなるかを考えます。つまり「非心度$\lambda$が$\alpha=.05$という状況でどのような値を取りうるか」です。非心度$\lambda$が決まれば、あとは勝手に$\rho$が上の式から計算できます。

このデータ(標本)ではt値は`r toukeiryou.t`です。非心度$\lambda$は「このt値が$\alpha=.05,df=40-2$という制約の非心t分布」の下限Max`r toukeiryou.t`まで下げれます。この値より下にいってしまうと**標本地と整合が取れない値**となりますので、このt値が下限Max(下側確率$\alpha=.025$)となるように非心t分布を調整してみます。

諸事情により、テキストの脚注にあるとおりMBESSパッケージの関数を使って非心度を計算します。ただし、テキスト内のコードから修正しています:

```{r}
require("MBESS")
lambda.ci <- conf.limits.nct(t.value=toukeiryou.t,df=40-2) #テキストのconf.coefという引数は無効なので除外
lambda.ci
```

この値はテキストと一致します。あとはテキストにあるとおりに計算すればOKです。

### 効果量の信頼区間と留意点
非常に重要なことあ書いてあります。**声に出して読みましょう**。
**声に出して読みましょう**

2節までは以上です。続きは静岡で2015年5月9日でやります。